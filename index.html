<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnimeVault - Your Personal Anime Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: #0f0f17;
            color: #e2e8f0;
            overflow-x: hidden;
        }
        
        .anime-card {
            transition: all 0.3s ease;
            transform-origin: center;
        }
        
        .anime-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 30px rgba(139, 92, 246, 0.3);
        }
        
        .score-badge {
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        
        .category-pill {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .category-pill:hover {
            transform: translateY(-2px);
        }
        
        .category-pill.active {
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            color: white;
        }
        
        .search-container {
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .search-container.active {
            width: 100%;
            max-width: 500px;
        }
        
        .modal-backdrop {
            backdrop-filter: blur(8px);
            background-color: rgba(15, 15, 23, 0.85);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(139, 92, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0); }
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1e293b;
            border-radius: 4px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #8b5cf6;
            border-radius: 4px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #7c3aed;
        }
        
        .list-item {
            transition: all 0.2s ease;
        }
        
        .list-item:hover {
            background-color: rgba(139, 92, 246, 0.1);
            padding-left: 1.5rem;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="bg-gray-900 border-b border-gray-800 sticky top-0 z-40">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-lg bg-gradient-to-r from-purple-600 to-pink-500 flex items-center justify-center">
                    <i class="fas fa-play text-white"></i>
                </div>
                <h1 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-600">
                    AnimeVault
                </h1>
            </div>
            
            <div class="flex items-center space-x-6">
                <div class="search-container flex items-center bg-gray-800 rounded-full px-4 py-2 w-12 overflow-hidden" id="searchContainer">
                    <input type="text" placeholder="Search anime..." class="bg-transparent border-none focus:outline-none w-0 text-white" id="searchInput">
                    <button id="searchToggle" class="text-gray-400 hover:text-white">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                
                <button id="addAnimeBtn" class="bg-gradient-to-r from-purple-600 to-pink-500 hover:from-purple-700 hover:to-pink-600 text-white px-4 py-2 rounded-full flex items-center space-x-2 transition-all">
                    <i class="fas fa-plus"></i>
                    <span>Add Anime</span>
                </button>
            </div>
        </div>
    </header>
    
    <div class="container mx-auto px-4 py-6 flex">
        <!-- Sidebar -->
        <aside class="w-64 pr-6 hidden md:block">
            <div class="bg-gray-900 rounded-xl p-5 mb-6">
                <h2 class="text-lg font-semibold mb-4 flex items-center">
                    <i class="fas fa-list-ul mr-2 text-purple-400"></i>
                    Categories
                </h2>
                <div class="space-y-2" id="categoriesContainer">
                    <div class="category-pill active px-4 py-2 rounded-lg bg-gray-800 flex items-center justify-between" data-category="watching">
                        <span>Watching</span>
                        <span class="text-xs bg-gray-700 px-2 py-1 rounded-full">0</span>
                    </div>
                    <div class="category-pill px-4 py-2 rounded-lg bg-gray-800 flex items-center justify-between" data-category="completed">
                        <span>Completed</span>
                        <span class="text-xs bg-gray-700 px-2 py-1 rounded-full">0</span>
                    </div>
                    <div class="category-pill px-4 py-2 rounded-lg bg-gray-800 flex items-center justify-between" data-category="plan-to-watch">
                        <span>Plan to Watch</span>
                        <span class="text-xs bg-gray-700 px-2 py-1 rounded-full">0</span>
                    </div>
                    <div class="category-pill px-4 py-2 rounded-lg bg-gray-800 flex items-center justify-between" data-category="on-hold">
                        <span>On Hold</span>
                        <span class="text-xs bg-gray-700 px-2 py-1 rounded-full">0</span>
                    </div>
                    <div class="category-pill px-4 py-2 rounded-lg bg-gray-800 flex items-center justify-between" data-category="dropped">
                        <span>Dropped</span>
                        <span class="text-xs bg-gray-700 px-2 py-1 rounded-full">0</span>
                    </div>
                </div>
            </div>
            
            <div class="bg-gray-900 rounded-xl p-5">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold flex items-center">
                        <i class="fas fa-star mr-2 text-yellow-400"></i>
                        Custom Lists
                    </h2>
                    <button id="addListBtn" class="text-purple-400 hover:text-purple-300">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <div class="space-y-2" id="customListsContainer">
                    <div class="list-item px-4 py-2 rounded-lg flex items-center justify-between cursor-pointer" data-list="favorites">
                        <span>Favorites</span>
                        <span class="text-xs bg-gray-700 px-2 py-1 rounded-full">0</span>
                    </div>
                    <div class="list-item px-4 py-2 rounded-lg flex items-center justify-between cursor-pointer" data-list="watch-again">
                        <span>Watch Again</span>
                        <span class="text-xs bg-gray-700 px-2 py-1 rounded-full">0</span>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="flex-1">
            <div class="mb-6 flex justify-between items-center">
                <h2 class="text-2xl font-bold" id="currentCategoryTitle">Watching</h2>
                <div class="flex space-x-3">
                    <button class="px-4 py-2 rounded-lg bg-gray-800 hover:bg-gray-700 flex items-center space-x-2">
                        <i class="fas fa-sort"></i>
                        <span>Sort</span>
                    </button>
                    <button class="px-4 py-2 rounded-lg bg-gray-800 hover:bg-gray-700 flex items-center space-x-2">
                        <i class="fas fa-filter"></i>
                        <span>Filter</span>
                    </button>
                </div>
            </div>
            
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-5" id="animeGrid">
                <!-- Anime cards will be dynamically inserted here -->
            </div>
            
            <div id="emptyState" class="text-center py-20 hidden">
                <div class="text-6xl text-gray-700 mb-4">
                    <i class="fas fa-film"></i>
                </div>
                <h3 class="text-xl font-semibold text-gray-400 mb-2">No anime found</h3>
                <p class="text-gray-500 mb-6">Add some anime to get started!</p>
                <button class="bg-gradient-to-r from-purple-600 to-pink-500 hover:from-purple-700 hover:to-pink-600 text-white px-6 py-3 rounded-full font-medium">
                    Add Your First Anime
                </button>
            </div>
        </main>
    </div>
    
    <!-- Anime Detail Modal -->
    <div id="animeModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-backdrop absolute inset-0" id="modalBackdrop"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-gray-900 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto custom-scrollbar relative z-10 fade-in">
                <div class="relative">
                    <img id="modalBanner" src="" alt="" class="w-full h-64 object-cover rounded-t-2xl">
                    <div class="absolute inset-0 bg-gradient-to-t from-gray-900 to-transparent rounded-t-2xl"></div>
                    <button id="closeModal" class="absolute top-4 right-4 w-10 h-10 rounded-full bg-gray-800 bg-opacity-70 flex items-center justify-center hover:bg-gray-700">
                        <i class="fas fa-times text-white"></i>
                    </button>
                </div>
                
                <div class="p-6">
                    <div class="flex flex-col md:flex-row gap-6">
                        <div class="md:w-1/3">
                            <img id="modalPoster" src="" alt="" class="w-full rounded-xl shadow-lg">
                            
                            <div class="mt-4 flex justify-between items-center">
                                <div>
                                    <h3 class="text-lg font-semibold">Your Score</h3>
                                    <div class="flex items-center mt-1">
                                        <div class="text-3xl font-bold text-purple-400" id="userScore">-</div>
                                        <span class="text-gray-400 ml-1">/10</span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <h3 class="text-lg font-semibold">Status</h3>
                                    <div class="mt-1">
                                        <span id="userStatus" class="px-3 py-1 rounded-full text-sm bg-gray-800">-</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-6">
                                <h3 class="text-lg font-semibold mb-3">Update Status</h3>
                                <div class="grid grid-cols-2 gap-2">
                                    <button class="status-btn px-3 py-2 rounded-lg bg-gray-800 hover:bg-purple-900 hover:bg-opacity-30 text-sm" data-status="watching">Watching</button>
                                    <button class="status-btn px-3 py-2 rounded-lg bg-gray-800 hover:bg-purple-900 hover:bg-opacity-30 text-sm" data-status="completed">Completed</button>
                                    <button class="status-btn px-3 py-2 rounded-lg bg-gray-800 hover:bg-purple-900 hover:bg-opacity-30 text-sm" data-status="plan-to-watch">Plan to Watch</button>
                                    <button class="status-btn px-3 py-2 rounded-lg bg-gray-800 hover:bg-purple-900 hover:bg-opacity-30 text-sm" data-status="on-hold">On Hold</button>
                                    <button class="status-btn px-3 py-2 rounded-lg bg-gray-800 hover:bg-purple-900 hover:bg-opacity-30 text-sm" data-status="dropped">Dropped</button>
                                    <button class="status-btn px-3 py-2 rounded-lg bg-gray-800 hover:bg-purple-900 hover:bg-opacity-30 text-sm" data-status="remove">Remove</button>
                                </div>
                            </div>
                            
                            <div class="mt-6">
                                <h3 class="text-lg font-semibold mb-3">Your Score</h3>
                                <div class="flex space-x-2" id="scoreButtons">
                                    <button class="score-btn w-10 h-10 rounded-full bg-gray-800 hover:bg-purple-900 hover:bg-opacity-30" data-score="1">1</button>
                                    <button class="score-btn w-10 h-10 rounded-full bg-gray-800 hover:bg-purple-900 hover:bg-opacity-30" data-score="2">2</button>
                                    <button class="score-btn w-10 h-10 rounded-full bg-gray-800 hover:bg-purple-900 hover:bg-opacity-30" data-score="3">3</button>
                                    <button class="score-btn w-10 h-10 rounded-full bg-gray-800 hover:bg-purple-900 hover:bg-opacity-30" data-score="4">4</button>
                                    <button class="score-btn w-10 h-10 rounded-full bg-gray-800 hover:bg-purple-900 hover:bg-opacity-30" data-score="5">5</button>
                                    <button class="score-btn w-10 h-10 rounded-full bg-gray-800 hover:bg-purple-900 hover:bg-opacity-30" data-score="6">6</button>
                                    <button class="score-btn w-10 h-10 rounded-full bg-gray-800 hover:bg-purple-900 hover:bg-opacity-30" data-score="7">7</button>
                                    <button class="score-btn w-10 h-10 rounded-full bg-gray-800 hover:bg-purple-900 hover:bg-opacity-30" data-score="8">8</button>
                                    <button class="score-btn w-10 h-10 rounded-full bg-gray-800 hover:bg-purple-900 hover:bg-opacity-30" data-score="9">9</button>
                                    <button class="score-btn w-10 h-10 rounded-full bg-gray-800 hover:bg-purple-900 hover:bg-opacity-30" data-score="10">10</button>
                                </div>
                            </div>
                            
                            <div class="mt-6">
                                <h3 class="text-lg font-semibold mb-3">Add to Custom Lists</h3>
                                <div class="space-y-2" id="customListCheckboxes">
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" class="rounded text-purple-500 focus:ring-purple-400" data-list="favorites">
                                        <span>Favorites</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" class="rounded text-purple-500 focus:ring-purple-400" data-list="watch-again">
                                        <span>Watch Again</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="md:w-2/3">
                            <h2 id="modalTitle" class="text-3xl font-bold mb-2"></h2>
                            <div class="flex flex-wrap gap-2 mb-4">
                                <span id="modalEpisodes" class="px-3 py-1 rounded-full bg-gray-800 text-sm"></span>
                                <span id="modalYear" class="px-3 py-1 rounded-full bg-gray-800 text-sm"></span>
                                <span id="modalStatus" class="px-3 py-1 rounded-full bg-gray-800 text-sm"></span>
                                <span id="modalFormat" class="px-3 py-1 rounded-full bg-gray-800 text-sm"></span>
                            </div>
                            
                            <div class="mb-6">
                                <h3 class="text-xl font-semibold mb-3">Description</h3>
                                <p id="modalDescription" class="text-gray-300"></p>
                            </div>
                            
                            <div class="mb-6">
                                <h3 class="text-xl font-semibold mb-3">External Scores</h3>
                                <div class="grid grid-cols-3 gap-4">
                                    <div class="bg-gray-800 rounded-xl p-4 text-center">
                                        <div class="text-sm text-gray-400 mb-1">Anilist</div>
                                        <div class="text-2xl font-bold text-purple-400" id="anilistScore">-</div>
                                    </div>
                                    <div class="bg-gray-800 rounded-xl p-4 text-center">
                                        <div class="text-sm text-gray-400 mb-1">MyAnimeList</div>
                                        <div class="text-2xl font-bold text-blue-400" id="malScore">-</div>
                                    </div>
                                    <div class="bg-gray-800 rounded-xl p-4 text-center">
                                        <div class="text-sm text-gray-400 mb-1">Kitsu</div>
                                        <div class="text-2xl font-bold text-green-400" id="kitsuScore">-</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h3 class="text-xl font-semibold mb-3">Genres</h3>
                                <div class="flex flex-wrap gap-2" id="modalGenres">
                                    <!-- Genres will be inserted here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Anime Modal -->
    <div id="addAnimeModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-backdrop absolute inset-0" id="addModalBackdrop"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-gray-900 rounded-2xl max-w-2xl w-full relative z-10 fade-in">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">Add New Anime</h2>
                        <button id="closeAddModal" class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center hover:bg-gray-700">
                            <i class="fas fa-times text-white"></i>
                        </button>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-400 mb-2">Search Anime</label>
                        <div class="relative">
                            <input type="text" id="animeSearch" placeholder="Type to search..." class="w-full bg-gray-800 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <div id="searchLoader" class="absolute right-3 top-3 hidden">
                                <i class="fas fa-spinner fa-spin text-purple-400"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div id="searchResults" class="max-h-96 overflow-y-auto custom-scrollbar">
                        <!-- Search results will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Custom List Modal -->
    <div id="addListModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-backdrop absolute inset-0" id="addListBackdrop"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-gray-900 rounded-2xl max-w-md w-full relative z-10 fade-in">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">Create New List</h2>
                        <button id="closeListModal" class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center hover:bg-gray-700">
                            <i class="fas fa-times text-white"></i>
                        </button>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-400 mb-2">List Name</label>
                        <input type="text" id="newListName" placeholder="Enter list name..." class="w-full bg-gray-800 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button id="cancelListBtn" class="px-4 py-2 rounded-lg bg-gray-800 hover:bg-gray-700">
                            Cancel
                        </button>
                        <button id="saveListBtn" class="px-4 py-2 rounded-lg bg-gradient-to-r from-purple-600 to-pink-500 hover:from-purple-700 hover:to-pink-600">
                            Create List
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let animeData = [];
        let currentCategory = 'watching';
        let customLists = ['favorites', 'watch-again'];
        let selectedAnime = null;
        
        // DOM Elements
        const searchToggle = document.getElementById('searchToggle');
        const searchContainer = document.getElementById('searchContainer');
        const searchInput = document.getElementById('searchInput');
        const animeGrid = document.getElementById('animeGrid');
        const emptyState = document.getElementById('emptyState');
        const categoriesContainer = document.getElementById('categoriesContainer');
        const customListsContainer = document.getElementById('customListsContainer');
        const animeModal = document.getElementById('animeModal');
        const addAnimeModal = document.getElementById('addAnimeModal');
        const addListModal = document.getElementById('addListModal');
        const currentCategoryTitle = document.getElementById('currentCategoryTitle');
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
          
          lace loadAnimeData() function
async function loadAnimeData() {
  try {
    const response = await fetch(`YOUR_WEB_APP_URL?category=${currentCategory}`);
    animeData = await response.json();
    renderAnimeGrid();
    updateCategoryCounts();
  } catch (error) {
    console.error('Error loading anime data:', error);
    // Fallback to localStorage
    const storedData = localStorage.getItem('animeData');
    if (storedData) {
      animeData = JSON.parse(storedData);
      renderAnimeGrid();
      updateCategoryCounts();
    }
  }
}
            
            // Set up event listeners
            setupEventListeners();
            
            // Render initial anime grid
            renderAnimeGrid();
            
            // Update category counts
            updateCategoryCounts();
        });
        
        // Load anime data from localStorage
        function loadAnimeData() {
            const storedData = localStorage.getItem('animeData');
            if (storedData) {
                animeData = JSON.parse(storedData);
            } else {
                // Initialize with sample data if none exists
                animeData = [
                    {
                        id: '1',
                        title: 'Attack on Titan',
                        image: 'https://cdn.myanimelist.net/images/anime/10/47347.jpg',
                        banner: 'https://cdn.myanimelist.net/images/anime/10/47347l.jpg',
                        description: 'Centuries ago, mankind was slaughtered to near extinction by monstrous humanoid creatures called Titans, forcing humans to hide in fear behind enormous concentric walls.',
                        score: 9,
                        status: 'watching',
                        dateAdded: '2023-01-15',
                        episodes: '75',
                        year: '2013',
                        format: 'TV',
                        genres: ['Action', 'Drama', 'Fantasy'],
                        anilistScore: 9.0,
                        malScore: 9.0,
                        kitsuScore: 4.7,
                        customLists: ['favorites']
                    },
                    {
                        id: '2',
                        title: 'Death Note',
                        image: 'https://cdn.myanimelist.net/images/anime/9/9453.jpg',
                        banner: 'https://cdn.myanimelist.net/images/anime/9/9453l.jpg',
                        description: 'A shinigami, as a god of death, can kill any person—provided they see their victim\'s face and write their victim\'s name in a notebook called a Death Note.',
                        score: 10,
                        status: 'completed',
                        dateAdded: '2023-02-20',
                        episodes: '37',
                        year: '2006',
                        format: 'TV',
                        genres: ['Thriller', 'Supernatural', 'Psychological'],
                        anilistScore: 8.6,
                        malScore: 9.0,
                        kitsuScore: 4.6,
                        customLists: ['favorites', 'watch-again']
                    },
                    {
                        id: '3',
                        title: 'Demon Slayer: Kimetsu no Yaiba',
                        image: 'https://cdn.myanimelist.net/images/anime/1286/99889.jpg',
                        banner: 'https://cdn.myanimelist.net/images/anime/1286/99889l.jpg',
                        description: 'Ever since the death of his father, the burden of supporting the family has fallen upon Tanjirou Kamado\'s shoulders.',
                        score: 8,
                        status: 'plan-to-watch',
                        dateAdded: '2023-03-10',
                        episodes: '26',
                        year: '2019',
                        format: 'TV',
                        genres: ['Action', 'Historical', 'Supernatural'],
                        anilistScore: 8.5,
                        malScore: 8.7,
                        kitsuScore: 4.5,
                        customLists: []
                    }
                ];
               
// Replace saveAnimeData() function
async function saveAnimeData() {
  try {
    await fetch('YOUR_WEB_APP_URL', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(animeData),
    });
  } catch (error) {
    console.error('Error saving anime data:', error);
    // Fallback to localStorage
    localStorage.setItem('animeData', JSON.stringify(animeData));
  }
}
            }
        }
        
        // Save anime data to localStorage
        function saveAnimeData() {
            localStorage.setItem('animeData', JSON.stringify(animeData));
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Search toggle
            searchToggle.addEventListener('click', () => {
                searchContainer.classList.toggle('active');
                if (searchContainer.classList.contains('active')) {
                    searchInput.focus();
                    searchInput.style.width = '100%';
                } else {
                    searchInput.style.width = '0';
                    searchInput.value = '';
                }
            });
            
            // Search input
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                if (searchTerm.length > 0) {
                    const filteredAnime = animeData.filter(anime => 
                        anime.title.toLowerCase().includes(searchTerm) ||
                        anime.genres.some(genre => genre.toLowerCase().includes(searchTerm))
                    );
                    renderAnimeGrid(filteredAnime);
                } else {
                    renderAnimeGrid();
                }
            });
            
            // Category selection
            categoriesContainer.addEventListener('click', (e) => {
                const categoryElement = e.target.closest('.category-pill');
                if (categoryElement) {
                    // Update active category
                    document.querySelectorAll('.category-pill').forEach(pill => {
                        pill.classList.remove('active');
                    });
                    categoryElement.classList.add('active');
                    
                    // Update current category
                    currentCategory = categoryElement.dataset.category;
                    currentCategoryTitle.textContent = categoryElement.querySelector('span').textContent;
                    
                    // Render anime grid
                    renderAnimeGrid();
                }
            });
            
            // Custom list selection
            customListsContainer.addEventListener('click', (e) => {
                const listItem = e.target.closest('.list-item');
                if (listItem) {
                    const listName = listItem.dataset.list;
                    currentCategory = `list:${listName}`;
                    currentCategoryTitle.textContent = listItem.querySelector('span').textContent;
                    
                    // Update active state
                    document.querySelectorAll('.category-pill').forEach(pill => {
                        pill.classList.remove('active');
                    });
                    
                    // Render anime grid
                    renderAnimeGrid();
                }
            });
            
            // Add anime button
            document.getElementById('addAnimeBtn').addEventListener('click', () => {
                addAnimeModal.classList.remove('hidden');
                document.getElementById('animeSearch').focus();
            });
            
            // Close add anime modal
            document.getElementById('closeAddModal').addEventListener('click', () => {
                addAnimeModal.classList.add('hidden');
                document.getElementById('animeSearch').value = '';
                document.getElementById('searchResults').innerHTML = '';
            });
            
            document.getElementById('addModalBackdrop').addEventListener('click', () => {
                addAnimeModal.classList.add('hidden');
                document.getElementById('animeSearch').value = '';
                document.getElementById('searchResults').innerHTML = '';
            });
            
            // Anime search
            document.getElementById('animeSearch').addEventListener('input', (e) => {
                const searchTerm = e.target.value;
                if (searchTerm.length > 2) {
                    searchAnime(searchTerm);
                } else {
                    document.getElementById('searchResults').innerHTML = '';
                }
            });
            
            // Close anime detail modal
            document.getElementById('closeModal').addEventListener('click', () => {
                animeModal.classList.add('hidden');
            });
            
            document.getElementById('modalBackdrop').addEventListener('click', () => {
                animeModal.classList.add('hidden');
            });
            
            // Add custom list button
            document.getElementById('addListBtn').addEventListener('click', () => {
                addListModal.classList.remove('hidden');
                document.getElementById('newListName').focus();
            });
            
            // Close add list modal
            document.getElementById('closeListModal').addEventListener('click', () => {
                addListModal.classList.add('hidden');
                document.getElementById('newListName').value = '';
            });
            
            document.getElementById('addListBackdrop').addEventListener('click', () => {
                addListModal.classList.add('hidden');
                document.getElementById('newListName').value = '';
            });
            
            // Cancel list creation
            document.getElementById('cancelListBtn').addEventListener('click', () => {
                addListModal.classList.add('hidden');
                document.getElementById('newListName').value = '';
            });
            
            // Save new list
            document.getElementById('saveListBtn').addEventListener('click', () => {
                const listName = document.getElementById('newListName').value.trim();
                if (listName) {
                    const listId = listName.toLowerCase().replace(/\s+/g, '-');
                    customLists.push(listId);
                    
                    // Add to UI
                    const listItem = document.createElement('div');
                    listItem.className = 'list-item px-4 py-2 rounded-lg flex items-center justify-between cursor-pointer';
                    listItem.dataset.list = listId;
                    listItem.innerHTML = `
                        <span>${listName}</span>
                        <span class="text-xs bg-gray-700 px-2 py-1 rounded-full">0</span>
                    `;
                    customListsContainer.appendChild(listItem);
                    
                    // Add to modal
                    const checkbox = document.createElement('label');
                    checkbox.className = 'flex items-center space-x-2 cursor-pointer';
                    checkbox.innerHTML = `
                        <input type="checkbox" class="rounded text-purple-500 focus:ring-purple-400" data-list="${listId}">
                        <span>${listName}</span>
                    `;
                    document.getElementById('customListCheckboxes').appendChild(checkbox);
                    
                    // Close modal
                    addListModal.classList.add('hidden');
                    document.getElementById('newListName').value = '';
                }
            });
        }
        
        // Render anime grid
        function renderAnimeGrid(animeList = null) {
            // Determine which anime to show
            let animeToShow = animeList || animeData;
            
            if (!animeList) {
                if (currentCategory.startsWith('list:')) {
                    const listName = currentCategory.split(':')[1];
                    animeToShow = animeData.filter(anime => anime.customLists && anime.customLists.includes(listName));
                } else {
                    animeToShow = animeData.filter(anime => anime.status === currentCategory);
                }
            }
            
            // Clear grid
            animeGrid.innerHTML = '';
            
            // Show empty state if no anime
            if (animeToShow.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            } else {
                emptyState.classList.add('hidden');
            }
            
            // Render anime cards
            animeToShow.forEach(anime => {
                const card = document.createElement('div');
                card.className = 'anime-card bg-gray-800 rounded-xl overflow-hidden cursor-pointer';
                card.innerHTML = `
                    <div class="relative">
                        <img src="${anime.image}" alt="${anime.title}" class="w-full h-48 object-cover">
                        <div class="absolute top-2 right-2 score-badge w-10 h-10 rounded-full flex items-center justify-center">
                            ${anime.score || '-'}
                        </div>
                    </div>
                    <div class="p-3">
                        <h3 class="font-semibold truncate">${anime.title}</h3>
                        <div class="flex justify-between items-center mt-2 text-xs text-gray-400">
                            <span>${anime.episodes || '?'} eps</span>
                            <span>${anime.year || '?'}</span>
                        </div>
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    openAnimeDetail(anime.id);
                });
                
                animeGrid.appendChild(card);
            });
        }
        
        // Update category counts
        function updateCategoryCounts() {
            // Update default categories
            const categories = ['watching', 'completed', 'plan-to-watch', 'on-hold', 'dropped'];
            categories.forEach(category => {
                const count = animeData.filter(anime => anime.status === category).length;
                const categoryElement = document.querySelector(`.category-pill[data-category="${category}"]`);
                if (categoryElement) {
                    categoryElement.querySelector('.bg-gray-700').textContent = count;
                }
            });
            
            // Update custom lists
            customLists.forEach(list => {
                const count = animeData.filter(anime => anime.customLists && anime.customLists.includes(list)).length;
                const listElement = document.querySelector(`.list-item[data-list="${list}"]`);
                if (listElement) {
                    listElement.querySelector('.bg-gray-700').textContent = count;
                }
            });
        }
        
        // Open anime detail modal
        function openAnimeDetail(animeId) {
            const anime = animeData.find(a => a.id === animeId);
            if (!anime) return;
            
            selectedAnime = anime;
            
            // Populate modal with anime data
            document.getElementById('modalBanner').src = anime.banner || anime.image;
            document.getElementById('modalPoster').src = anime.image;
            document.getElementById('modalTitle').textContent = anime.title;
            document.getElementById('modalDescription').textContent = anime.description;
            document.getElementById('userScore').textContent = anime.score || '-';
            document.getElementById('userStatus').textContent = anime.status.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
            document.getElementById('modalEpisodes').textContent = `${anime.episodes || '?'} Episodes`;
            document.getElementById('modalYear').textContent = anime.year || '?';
            document.getElementById('modalStatus').textContent = anime.status.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
            document.getElementById('modalFormat').textContent = anime.format || '?';
            document.getElementById('anilistScore').textContent = anime.anilistScore || '-';
            document.getElementById('malScore').textContent = anime.malScore || '-';
            document.getElementById('kitsuScore').textContent = anime.kitsuScore ? (anime.kitsuScore * 2).toFixed(1) : '-';
            
            // Populate genres
            const genresContainer = document.getElementById('modalGenres');
            genresContainer.innerHTML = '';
            anime.genres.forEach(genre => {
                const genreTag = document.createElement('span');
                genreTag.className = 'px-3 py-1 rounded-full bg-gray-800 text-sm';
                genreTag.textContent = genre;
                genresContainer.appendChild(genreTag);
            });
            
            // Set status button states
            document.querySelectorAll('.status-btn').forEach(btn => {
                btn.classList.remove('bg-purple-900', 'bg-opacity-30');
                if (btn.dataset.status === anime.status) {
                    btn.classList.add('bg-purple-900', 'bg-opacity-30');
                }
            });
            
            // Set score button states
            document.querySelectorAll('.score-btn').forEach(btn => {
                btn.classList.remove('bg-purple-900', 'bg-opacity-30');
                if (parseInt(btn.dataset.score) === anime.score) {
                    btn.classList.add('bg-purple-900', 'bg-opacity-30');
                }
            });
            
            // Set custom list checkboxes
            document.querySelectorAll('#customListCheckboxes input').forEach(checkbox => {
                checkbox.checked = anime.customLists && anime.customLists.includes(checkbox.dataset.list);
            });
            
            // Set up event listeners for status buttons
            document.querySelectorAll('.status-btn').forEach(btn => {
                btn.onclick = () => {
                    if (btn.dataset.status === 'remove') {
                        // Remove anime from collection
                        animeData = animeData.filter(a => a.id !== anime.id);
                        saveAnimeData();
                        renderAnimeGrid();
                        updateCategoryCounts();
                        animeModal.classList.add('hidden');
                    } else {
                        // Update anime status
                        anime.status = btn.dataset.status;
                        saveAnimeData();
                        renderAnimeGrid();
                        updateCategoryCounts();
                        
                        // Update button states
                        document.querySelectorAll('.status-btn').forEach(b => {
                            b.classList.remove('bg-purple-900', 'bg-opacity-30');
                        });
                        btn.classList.add('bg-purple-900', 'bg-opacity-30');
                        
                        // Update status display
                        document.getElementById('userStatus').textContent = btn.dataset.status.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
                    }
                };
            });
            
            // Set up event listeners for score buttons
            document.querySelectorAll('.score-btn').forEach(btn => {
                btn.onclick = () => {
                    anime.score = parseInt(btn.dataset.score);
                    saveAnimeData();
                    renderAnimeGrid();
                    
                    // Update button states
                    document.querySelectorAll('.score-btn').forEach(b => {
                        b.classList.remove('bg-purple-900', 'bg-opacity-30');
                    });
                    btn.classList.add('bg-purple-900', 'bg-opacity-30');
                    
                    // Update score display
                    document.getElementById('userScore').textContent = anime.score;
                };
            });
            
            // Set up event listeners for custom list checkboxes
            document.querySelectorAll('#customListCheckboxes input').forEach(checkbox => {
                checkbox.onchange = () => {
                    if (!anime.customLists) {
                        anime.customLists = [];
                    }
                    
                    if (checkbox.checked) {
                        if (!anime.customLists.includes(checkbox.dataset.list)) {
                            anime.customLists.push(checkbox.dataset.list);
                        }
                    } else {
                        anime.customLists = anime.customLists.filter(list => list !== checkbox.dataset.list);
                    }
                    
                    saveAnimeData();
                    updateCategoryCounts();
                };
            });
            
            // Show modal
            animeModal.classList.remove('hidden');
        }
        
        // Search for anime (simulated API call)
        function searchAnime(searchTerm) {
            // Show loader
            document.getElementById('searchLoader').classList.remove('hidden');
            
            // Simulate API delay
            setTimeout(() => {
                // In a real app, this would be an API call to Anilist, MAL, etc.
                // For demo purposes, we'll use mock data
                const mockResults = [
                    {
                        id: '4',
                        title: 'One Piece',
                        image: 'https://cdn.myanimelist.net/images/anime/6/73245.jpg',
                        description: 'Gol D. Roger was known as the "Pirate King," the strongest and most infamous being to have sailed the Grand Line.',
                        episodes: '1000+',
                        year: '1999',
                        format: 'TV',
                        genres: ['Action', 'Adventure', 'Comedy']
                    },
                    {
                        id: '5',
                        title: 'Naruto',
                        image: 'https://cdn.myanimelist.net/images/anime/13/17405.jpg',
                        description: 'Moments prior to Naruto Uzumaki\'s birth, a huge demon known as the Kyuubi, the Nine-Tailed Fox, attacked Konohagakure, the Hidden Leaf Village, and wreaked havoc.',
                        episodes: '220',
                        year: '2002',
                        format: 'TV',
                        genres: ['Action', 'Adventure', 'Martial Arts']
                    },
                    {
                        id: '6',
                        title: 'My Hero Academia',
                        image: 'https://cdn.myanimelist.net/images/anime/10/78745.jpg',
                        description: 'The appearance of "Quirks," newly discovered super powers, has been steadily increasing over the years, with 80 percent of humanity possessing various abilities from manipulation of elements to shapeshifting.',
                        episodes: '113',
                        year: '2016',
                        format: 'TV',
                        genres: ['Action', 'School', 'Super Power']
                    }
                ];
                
                // Filter results based on search term
                const filteredResults = mockResults.filter(anime => 
                    anime.title.toLowerCase().includes(searchTerm.toLowerCase())
                );
                
                // Display results
                const searchResultsContainer = document.getElementById('searchResults');
                searchResultsContainer.innerHTML = '';
                
                if (filteredResults.length === 0) {
                    searchResultsContainer.innerHTML = '<p class="text-center py-4 text-gray-500">No results found</p>';
                } else {
                    filteredResults.forEach(anime => {
                        const resultItem = document.createElement('div');
                        resultItem.className = 'flex items-center p-3 bg-gray-800 rounded-lg mb-3 cursor-pointer hover:bg-gray-700';
                        resultItem.innerHTML = `
                            <img src="${anime.image}" alt="${anime.title}" class="w-16 h-16 rounded-lg object-cover">
                            <div class="ml-4 flex-1">
                                <h3 class="font-semibold">${anime.title}</h3>
                                <p class="text-sm text-gray-400">${anime.episodes} episodes • ${anime.year}</p>
                            </div>
                            <button class="bg-gradient-to-r from-purple-600 to-pink-500 hover:from-purple-700 hover:to-pink-600 text-white px-4 py-2 rounded-lg">
                                Add
                            </button>
                        `;
                        
                        resultItem.addEventListener('click', () => {
                            addAnimeToList(anime);
                        });
                        
                        searchResultsContainer.appendChild(resultItem);
                    });
                }
                
                // Hide loader
                document.getElementById('searchLoader').classList.add('hidden');
            }, 800);
        }
        
        // Add anime to list
        function addAnimeToList(anime) {
            // Check if anime already exists
            const existingAnime = animeData.find(a => a.id === anime.id);
            if (existingAnime) {
                // Show notification that anime already exists
                showNotification('This anime is already in your list!');
                return;
            }
            
            // Add new anime with default values
            const newAnime = {
                ...anime,
                score: null,
                status: 'plan-to-watch',
                dateAdded: new Date().toISOString().split('T')[0],
                anilistScore: (Math.random() * 2 + 7).toFixed(1), // Random score between 7-9
                malScore: (Math.random() * 2 + 7).toFixed(1),    // Random score between 7-9
                kitsuScore: (Math.random() * 0.5 + 4).toFixed(1), // Random score between 4-4.5
                customLists: []
            };
            
            animeData.push(newAnime);
            saveAnimeData();
            renderAnimeGrid();
            updateCategoryCounts();
            
            // Close modal
            addAnimeModal.classList.add('hidden');
            document.getElementById('animeSearch').value = '';
            document.getElementById('searchResults').innerHTML = '';
            
            // Show success notification
            showNotification(`${anime.title} added to your list!`);
        }
        
        // Show notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed bottom-4 right-4 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg z-50 fade-in';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>
